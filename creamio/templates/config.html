<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Configure Creamio</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body { 
            background-color: #f0f2f5; 
            color: #333; 
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        .card { 
            border: none; 
            border-radius: 12px; 
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }
        .card-header {
            background-color: #fff;
            border-bottom: 1px solid #eee;
            border-radius: 12px 12px 0 0 !important;
            padding: 1.5rem;
        }
        .form-label {
            font-weight: 600;
            color: #555;
            margin-bottom: 0.5rem;
        }
        .form-control {
            border-radius: 8px;
            padding: 0.75rem;
            border: 1px solid #ddd;
            background-color: #fff;
        }
        .form-control:focus {
            border-color: #8b5cf6;
            box-shadow: 0 0 0 3px rgba(139, 92, 246, 0.1);
        }
        .section-title {
            color: #8b5cf6; /* Soft Purple */
            font-size: 1.1rem;
            font-weight: 700;
            margin-top: 1.5rem;
            margin-bottom: 1rem;
            border-bottom: 2px solid #f0f2f5;
            padding-bottom: 0.5rem;
        }
        .btn-primary {
            background-color: #8b5cf6;
            border-color: #8b5cf6;
            padding: 0.75rem;
            font-weight: 600;
            border-radius: 8px;
            transition: all 0.2s;
        }
        .btn-primary:hover {
            background-color: #7c3aed;
            border-color: #7c3aed;
        }
        .result-box {
            background-color: #1e1e1e;
            color: #a6e22e;
            font-family: monospace;
            padding: 1rem;
            border-radius: 6px;
            word-break: break-all;
            display: none; /* Hidden by default */
            margin-top: 1.5rem;
            border: 1px solid #333;
        }
    </style>
</head>
<body class="py-5">
    <div class="container" style="max-width: 600px;">
        <div class="card">
            <div class="card-header text-center">
                <h2 class="mb-0">üç¶ Creamio Configuration</h2>
                <p class="text-muted mt-2 mb-0">StashDB + Real Debrid / TorBox / Easynews</p>
            </div>
            <div class="card-body p-4">
                <form id="configForm">
                    
                    <!-- StashDB -->
                    <div class="section-title">Metadata Provider</div>
                    <div class="mb-3">
                        <label class="form-label">StashDB API Key (Optional)</label>
                        <input type="text" class="form-control" id="stashdb_key" placeholder="Leave empty to use public instance">
                    </div>

                    <!-- Debrid Providers -->
                    <div class="section-title">Debrid Services</div>
                    
                    <!-- Real Debrid -->
                    <div class="mb-3">
                        <label class="form-label">Real Debrid API Token</label>
                        <input type="text" class="form-control" id="rd_key" placeholder="Find at https://real-debrid.com/apitoken">
                    </div>

                    <!-- TorBox -->
                    <div class="mb-3">
                        <label class="form-label">TorBox API Key</label>
                        <input type="text" class="form-control" id="torbox_key" placeholder="From TorBox Settings">
                    </div>

                    <!-- Easynews -->
                    <div class="section-title">Easynews (Optional)</div>
                    <div class="row g-3">
                        <div class="col-md-6">
                            <label class="form-label">Username</label>
                            <input type="text" class="form-control" id="easynews_user" placeholder="username">
                        </div>
                        <div class="col-md-6">
                            <label class="form-label">Password</label>
                            <input type="password" class="form-control" id="easynews_pass" placeholder="password">
                        </div>
                    </div>

                    <button type="button" class="btn btn-primary w-100 mt-5" onclick="generateLink()">Generate Install Link</button>
                </form>

                <!-- Result Area -->
                <div id="resultArea" class="mt-4" style="display: none;">
                    <label class="form-label">Addon URL (Copy this)</label>
                    <div class="input-group mb-3">
                        <input type="text" class="form-control" id="addonUrl" readonly>
                        <button class="btn btn-outline-secondary" type="button" onclick="copyLink()">Copy</button>
                    </div>
                    <div class="d-grid">
                        <a id="installBtn" href="#" class="btn btn-success">Install in Stremio</a>
                    </div>
                </div>

            </div>
        </div>
    </div>

    <script>
        function generateLink() {
            const config = {
                stashdb_key: document.getElementById('stashdb_key').value.trim(),
                rd_key: document.getElementById('rd_key').value.trim(),
                torbox_key: document.getElementById('torbox_key').value.trim(),
                easynews_user: document.getElementById('easynews_user').value.trim(),
                easynews_pass: document.getElementById('easynews_pass').value.trim()
            };

            // Remove empty keys
            Object.keys(config).forEach(key => !config[key] && delete config[key]);

            const jsonStr = JSON.stringify(config);
            const b64 = btoa(jsonStr); // Base64 encode
            
            // Construct URL
            const host = window.location.host;
            const protocol = window.location.protocol;
            const fullUrl = `${protocol}//${host}/${b64}/manifest.json`;
            const stremioUrl = fullUrl.replace('http', 'stremio');

            // Show results
            document.getElementById('resultArea').style.display = 'block';
            document.getElementById('addonUrl').value = fullUrl;
            document.getElementById('installBtn').href = stremioUrl;
        }

        function copyLink() {
            const copyText = document.getElementById("addonUrl");
            copyText.select();
            copyText.setSelectionRange(0, 99999); 
            navigator.clipboard.writeText(copyText.value);
            alert("Link copied: " + copyText.value);
        }
    </script>
</body>
</html>
