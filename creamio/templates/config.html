<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Configure Creamio</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body { background-color: #1a1a1a; color: #eee; }
        .card { background-color: #2d2d2d; border-color: #444; }
        .form-control { background-color: #333; color: #fff; border-color: #555; }
        .form-control:focus { background-color: #444; color: #fff; }
    </style>
</head>
<body class="py-5">
    <div class="container" style="max-width: 600px;">
        <div class="card shadow">
            <div class="card-body p-4">
                <h2 class="card-title text-center mb-4">üç¶ Creamio Configuration</h2>
                
                <form id="configForm">
                    <!-- StashDB (Optional Override) -->
                    <h5 class="mb-3 border-bottom pb-2">StashDB</h5>
                    <div class="mb-3">
                        <label class="form-label">API Key (Optional)</label>
                        <input type="text" class="form-control" id="stashdb_key" placeholder="If using a private instance">
                    </div>

                    <!-- Real Debrid -->
                    <h5 class="mb-3 border-bottom pb-2 mt-4">Real Debrid</h5>
                    <div class="mb-3">
                        <label class="form-label">API Token</label>
                        <input type="text" class="form-control" id="rd_key" placeholder="Find at https://real-debrid.com/apitoken">
                    </div>

                    <!-- Easynews -->
                    <h5 class="mb-3 border-bottom pb-2 mt-4">Easynews</h5>
                    <div class="row">
                        <div class="col">
                            <input type="text" class="form-control" id="easynews_user" placeholder="Username">
                        </div>
                        <div class="col">
                            <input type="password" class="form-control" id="easynews_pass" placeholder="Password">
                        </div>
                    </div>

                    <button type="button" class="btn btn-primary w-100 mt-5" onclick="install()">Install Addon</button>
                </form>
            </div>
        </div>
    </div>

    <script>
        function install() {
            const config = {
                stashdb_key: document.getElementById('stashdb_key').value,
                rd_key: document.getElementById('rd_key').value,
                easynews_user: document.getElementById('easynews_user').value,
                easynews_pass: document.getElementById('easynews_pass').value
            };

            // Remove empty keys
            Object.keys(config).forEach(key => !config[key] && delete config[key]);

            const jsonStr = JSON.stringify(config);
            const b64 = btoa(jsonStr); // Base64 encode
            
            // Construct Stremio Install Link
            // Protocol: stremio://{host}/{config}/manifest.json
            const host = window.location.host;
            const protocol = window.location.protocol.replace('http', 'stremio');
            
            window.location.href = `${protocol}//${host}/${b64}/manifest.json`;
        }
    </script>
</body>
</html>
